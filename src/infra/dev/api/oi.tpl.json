{
  "openapi": "3.0.3",
  "info": {
    "title": "OI - OpenAPI 3.0",
    "description": "OI description\n\nSome useful links:\n- [One Identity repository](https://github.com/pagopa/oneidentity)\n- [The source API definition for OI](https://github.com/pagopa/oneidentity/blob/master/src/main/resources/openapi.yaml)",
    "termsOfService": "http://pagopa.it/terms/",
    "contact": {
      "email": "xxx@pagopa.it"
    },
    "license": {
      "name": "Apache 2.0",
      "url": "https://www.apache.org/licenses/LICENSE-2.0.html"
    },
    "version": "0.0.1"
  },
  "externalDocs": {
    "description": "Find out more about OI",
    "url": "https://pagopa.it"
  },
  "servers": [
    {
      "url": "${server_url}"
    }
  ],
  "paths": {
    "/status": {
      "get": {
        "tags": ["Authorization Server APIs"],
        "description": "[SHOULD BE RENAMED TO /status] An endpoint that can be used to verify the actual service health",
        "operationId": "Get_request_health_check",
        "x-amazon-apigateway-integration" : {
          "type": "HTTP",
          "httpMethod":"GET",
          "uri" : "${uri}/ping",
          "connectionType" : "VPC_LINK",
          "connectionId"        : "${connection_id}",
          "requestParameters"   : {},
          "passthroughBehavior" : "WHEN_NO_TEMPLATES",
          "responses" : {
            "200" : {
              "statusCode" : "200",
              "responseParameters" : {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "Responds with no content"
          },
          "500": {
            "description": "Responds with \"error\". This can be due to missing or incorrect API key. Check audit log messages for more information."
          },
          "503": {
            "description": "Responds with \"error\". Returned on health check failure. This can be returned due to bad database configuration, bad certification configuration, etc. Check the audit log messages for more information."
          }
        }
      }
    },
    "/login": {
      "get": {
        "tags": ["Login landing page"],
        "description": "This route will serve the login landing page, where users can choose which IDP use",
        "parameters": [
          {
            "name": "client_id",
            "in": "query",
            "required": true,
            "description": "This is the 'client_id' of the requesting client. Maximum 255 characters.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "response_type",
            "in": "query",
            "required": true,
            "description": "MUST be one of the listed available values. Any response_type other than 'code' or 'token' is only supported in conjunction with scope=openid. As per the OAuth specification: 'code' is used for authorization code grant type flow, 'token' is used for implicit grant type flow, 'token id_token' is an extension provided by OpenID Connect, and 'code id_token', 'id_token', and 'none' are extensions provided by OpenID Connect Multiple Response Types",
            "schema": {
              "type": "string",
              "default": "code",
              "enum": [
                "code",
                "token",
                "token id_token",
                "code id_token",
                "id_token",
                "code token",
                "code id_token token",
                "none"
              ]
            }
          },
          {
            "name": "redirect_uri",
            "in": "query",
            "required": false,
            "description": "The 'redirect_uri' that was registered for this client. It is required if multiple redirect_uri's have been registered for this client. If the scope contains openid, this field becomes MANDATORY.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "scope",
            "in": "query",
            "required": false,
            "description": "Only SCOPE values that were registered for this client will be granted. If only non-matching SCOPE values are requested, the request will fail.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "nonce",
            "in": "query",
            "required": false,
            "description": "This is required for response_type 'token id_token'.  Typically, in an OpenID authorization scheme, the nonce represents a cryptographically strong random  string that is used to prevent intercepted responses from being reused.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "state",
            "in": "query",
            "required": false,
            "description": "Value opaque to the server, used by the client to track its session. It will be returned as received.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "x-amazon-apigateway-integration" : {
          "type": "HTTP",
          "httpMethod":"GET",
          "uri" : "${uri}/login",
          "connectionType" : "VPC_LINK",
          "connectionId"        : "${connection_id}",
          "requestParameters"   : {},
          "passthroughBehavior" : "WHEN_NO_TEMPLATES",
          "responses" : {
            "200" : {
              "statusCode" : "200",
              "requestParameters" : {
                "integration.request.querystring.client_id": "method.request.querystring.client_id",
                "integration.request.querystring.response_type": "method.request.querystring.response_type",
                "integration.request.querystring.redirect_uri": "method.request.querystring.redirect_uri",
                "integration.request.querystring.scope": "method.request.multivaluequerystring.scope",
                "integration.request.querystring.nonce": "method.request.querystring.nonce",
                "integration.request.querystring.state": "method.request.querystring.state"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "headers": {
              "location": {
                "description": "Location (URL) includes these required parameters: action=(display or login depending on 'prompt' and 'id_token_hint') and sessionID and sessionData (a JWT containing a JSON message holding session data)",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Invalid parameters | Invalid redirect_uri | invalid client type | invalid response type | invalid code_challenge/method",
            "headers": {
              "Pragma": {
                "description": "Pragma browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-cache"
                }
              },
              "Cache-Control": {
                "description": "Cache-Control browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-store"
                }
              }
            }
          },
          "401": {
            "description": "The client could not be authenticated.",
            "headers": {
              "Pragma": {
                "description": "Pragma browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-cache"
                }
              },
              "Cache-Control": {
                "description": "Cache-Control browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-store"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden.",
            "headers": {
              "Pragma": {
                "description": "Pragma browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-cache"
                }
              },
              "Cache-Control": {
                "description": "Cache-Control browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-store"
                }
              }
            }
          },
          "405": {
            "description": "The HTTP method is not valid",
            "headers": {
              "Allow": {
                "description": "This header is required by RFC 2616 and contains a comma separated list of valid HTTP methods.",
                "schema": {
                  "type": "string",
                  "default": "GET,POST"
                }
              },
              "Pragma": {
                "description": "Pragma browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-cache"
                }
              },
              "Cache-Control": {
                "description": "Cache-Control browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-store"
                }
              }
            }
          },
          "500": {
            "description": "unknown error",
            "headers": {
              "Pragma": {
                "description": "Pragma browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-cache"
                }
              },
              "Cache-Control": {
                "description": "Cache-Control browser directive",
                "schema": {
                  "type": "string",
                  "default": "no-store"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "responses": {
      "auth302": {
        "description": "Will contain either: A success response including the redirect location header to the server that handles the authentication.  The redirect parameter 'sessionData's structure looks like the model schema shown OR 'invalid scope' OR 'unsupported response type' OR 'unauthorized client'. The non-successful conditions may include redirect query params as follows: 'error', string with default value:  invalid_request 'error_description', string with description of error 'state', string with no default value.  It is opaque to the server and returned as received. 'x-ca-err', string with default 3000108",
        "headers": {
          "location": {
            "description": "Location (URL) includes these required parameters: action=(display or login depending on 'prompt' and 'id_token_hint') and sessionID and sessionData (a JWT containing a JSON message holding session data)",
            "schema": {
              "type": "string"
            }
          },
          "Pragma": {
            "description": "Pragma directive",
            "schema": {
              "type": "string",
              "default": "no-cache"
            }
          },
          "Cache-Control": {
            "description": "Cache control directive",
            "schema": {
              "type": "string",
              "default": "no-store"
            }
          }
        }
      },
      "authToken200": {
        "description": "A success response that includes the issued token, expire and other details from the OAuth Server",
        "headers": {
          "Pragma": {
            "description": "Pragma browser directive",
            "schema": {
              "type": "string",
              "default": "no-cache"
            }
          },
          "Cache-Control": {
            "description": "Cache-Control browser directive",
            "schema": {
              "type": "string",
              "default": "no-store"
            }
          }
        },
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/TokenData"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "openId": {
        "type": "openIdConnect",
        "openIdConnectUrl": "/.well-known/openid-configuration"
      }
    },
    "schemas": {
      "TokenData": {
        "type": "object",
        "properties": {
          "access_token": {
            "type": "string",
            "description": "The Access Token for the given token request"
          },
          "token_type": {
            "type": "string",
            "description": "The Token Type issued",
            "example": "Bearer"
          },
          "expires_in": {
            "type": "string",
            "description": "The expiry time, in seconds",
            "example": "3600"
          },
          "refresh_token": {
            "type": "string",
            "description": "The refresh token, if applicable"
          },
          "scope": {
            "type": "string",
            "description": "The issued scope",
            "example": "oob"
          },
          "id_token": {
            "type": "string",
            "description": "If the requested SCOPE included 'msso' or 'openid', response includes an id_token"
          },
          "id_token_type": {
            "type": "string",
            "description": "If the requested SCOPE included 'msso' or 'openid', response includes an id_token_type"
          }
        },
        "title": "TokenData"
      },
      "OpenIDDiscovery": {
        "required": [
          "authorization_endpoint",
          "id_token_signing_alg_values_supported",
          "issuer",
          "jwks_uri",
          "response_types_supported",
          "subject_types_supported",
          "token_endpoint"
        ],
        "type": "object",
        "properties": {
          "userinfo_endpoint": {
            "type": "string",
            "example": "https://example.org/oidc/v1/userinfo",
            "description": "URL of the user info endpoint"
          },
          "jwks_uri": {
            "type": "string",
            "example": "https://example.org/oidc/v1/keys",
            "description": "URL of JSON Web Key Set document"
          },
          "scopes_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["openid"],
            "description": "list of the OAuth 2.0 scope values that this server supports"
          },
          "subject_types_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["pairwise"],
            "description": "list of the Subject Identifier types that this OP supports"
          },
          "token_endpoint": {
            "type": "string",
            "example": "https://example.org/oidc/v1/token",
            "description": "URL of the OAuth 2.0 token endpoint"
          },
          "id_token_signing_alg_values_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["RS256", "HS256"],
            "description": "list of the JWS signing algorithms (alg values) supported by the OP for the ID Token to encode the Claims in a JWT"
          },
          "response_types_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["code", "token_id_token"],
            "description": "ist of the OAuth 2.0 response_type values that this OP supports"
          },
          "claims_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["sub", "iss", "auth_time", "acr"],
            "description": "list of the Claim Names of the Claims that the OpenID Provider MAY be able to supply values for"
          },
          "authorization_endpoint": {
            "type": "string",
            "example": "https://example.org/oidc/v1/authorize",
            "description": "URL of the OAuth 2.0 authorization endpoint"
          },
          "issuer": {
            "type": "string",
            "example": "https://example.org",
            "description": "the identifier of the token's issuer. This is identical to the 'iss' Claim value in ID Tokens"
          },
          "grant_types_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["authorization_code", "implicit"],
            "description": "list of the OAuth 2.0 Grant Type values that this OP supports"
          },
          "acr_values_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["urn:mace:incommon:iap:silver"],
            "description": "list of the Authentication Context Class References that this OP supports"
          },
          "token_endpoint_auth_methods_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["client_secret_basic"],
            "description": "list of Client Authentication methods supported by this Token Endpoint"
          },
          "token_endpoint_auth_signing_alg_values_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["RS256"],
            "description": "list of the JWS signing algorithms (alg values) supported by the Token Endpoint for the signature on the JWT used to authenticate the Client at the Token Endpoint for the private_key_jwt and client_secret_jwt authentication methods. Servers SHOULD support RS256. The value none MUST NOT be used."
          },
          "display_values_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["page", "popup"],
            "description": "list of the display parameter values that the OpenID Provider supports"
          },
          "claim_types_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["normal"],
            "description": "list of the Claim Types that the OpenID Provider supports"
          },
          "service_documentation": {
            "type": "string",
            "example": "https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth",
            "description": "URL of a page containing human-readable information that developers might want or need to know when using the OpenID Provider"
          },
          "ui_locales_supported": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "example": ["en-US", "en-GB"],
            "description": "Languages and scripts supported for the user interface"
          }
        },
        "description": "The OpenID configuration document as defined by the specification: http://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata"
      }
    }
  }
}
